<div class="h-full">
  <mat-drawer-container [hasBackdrop]="'true'" class="h-full">
    <mat-drawer style="width: 25rem" #drawer [mode]="'over'" [position]="'end'">
      <router-outlet></router-outlet>
    </mat-drawer>

    <mat-drawer-content class="flex h-full flex-col">
      <section class="h-full overflow-y-auto bg-gray-50 py-3 sm:py-5 dark:bg-gray-900">
        <div class="mx-auto max-w-screen-2xl px-4 lg:px-12">
          <div class="mb-42 relative overflow-hidden bg-white sm:rounded-lg dark:bg-gray-800">
            <div
              class="flex flex-col space-y-3 px-4 py-3 lg:flex-row lg:items-center lg:justify-between lg:space-x-4 lg:space-y-0">
              <div class="flex items-center">
                <div class="relative w-full">
                  <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                    <svg
                      aria-hidden="true"
                      class="h-5 w-5 text-gray-500 dark:text-gray-400"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                      xmlns="http://www.w3.org/2000/svg">
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                  </div>
                  <input
                    type="text"
                    placeholder="Search..."
                    id="default-input"
                    [formControl]="searchInputControl"
                    class="block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 pl-10 text-sm text-gray-900 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 dark:focus:border-blue-500 dark:focus:ring-blue-500" />

                  <button
                    type="submit"
                    class="absolute right-0 top-0 rounded-r-lg border border-blue-700 bg-blue-700 p-2.5 text-sm font-medium text-white hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">
                    <svg
                      aria-hidden="true"
                      class="h-5 w-5"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                      xmlns="http://www.w3.org/2000/svg">
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                  </button>
                </div>
              </div>

              <div
                class="flex flex-shrink-0 flex-col space-y-3 md:flex-row md:items-center md:space-x-3 md:space-y-0 lg:justify-end">
                <button
                  type="button"
                  (click)="addProduct()"
                  routerLink="./add"
                  class="inline-flex items-center justify-center rounded-lg bg-blue-700 px-4 py-2 text-sm font-medium text-white hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">
                  <mat-icon class="mr-1">add</mat-icon>
                  New product
                </button>

                <button
                  type="button"
                  (click)="export()"
                  class="inline-flex items-center justify-center rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm font-medium text-gray-900 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white dark:focus:ring-gray-700">
                  <mat-icon>download</mat-icon>
                  <span>Download</span>
                </button>
              </div>
            </div>
            <div class="overflow-x-auto">
              <table class="w-full text-left text-sm text-gray-500 dark:text-gray-400">
                <thead class="bg-gray-50 text-xs uppercase text-gray-700 dark:bg-gray-700 dark:text-gray-400">
                  <tr>
                    <th scope="col" class="p-4">
                      <div class="flex items-center">
                        <input
                          id="checkbox-all"
                          type="checkbox"
                          class="h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:ring-offset-gray-800 dark:focus:ring-blue-600" />
                        <label for="checkbox-all" class="sr-only">checkbox</label>
                      </div>
                    </th>
                    <th scope="col" class="px-4 py-3">Product</th>
                    <th scope="col" class="px-4 py-3">Category</th>
                    <th scope="col" class="px-4 py-3">Stock</th>
                    <th scope="col" class="px-4 py-3">Price</th>
                    <th scope="col" class="px-4 py-3">Sales/Day</th>
                    <th scope="col" class="px-4 py-3">Sales/Month</th>
                    <th scope="col" class="px-4 py-3">Rating</th>
                    <th scope="col" class="px-4 py-3">Sales</th>
                    <th scope="col" class="px-4 py-3">Revenue</th>
                    <th scope="col" class="px-4 py-3">Last Update</th>
                    <th scope="col" class="px-4 py-3">Action</th>
                  </tr>
                </thead>
                <tbody>
                  @for (product of products; track product.id) {
                    <tr class="border-b hover:bg-gray-100 dark:border-gray-600 dark:hover:bg-gray-700">
                      <td class="w-4 px-4 py-3">
                        <div class="flex items-center">
                          <input
                            id="checkbox-table-search-1"
                            type="checkbox"
                            onclick="event.stopPropagation()"
                            class="h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:ring-offset-gray-800 dark:focus:ring-blue-600" />
                          <label for="checkbox-table-search-1" class="sr-only">checkbox</label>
                        </div>
                      </td>
                      <th
                        scope="row"
                        class="flex items-center whitespace-nowrap px-4 py-2 font-medium text-gray-900 dark:text-white">
                        <img [src]="product.img" alt="pro img" class="mr-3 h-8 w-auto" />
                        {{ product.name }}
                      </th>
                      <td class="px-4 py-2">
                        <span
                          class="rounded bg-blue-100 px-2 py-0.5 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-300"
                          >{{ product.category }}</span
                        >
                      </td>
                      <td class="whitespace-nowrap px-4 py-2 font-medium text-gray-900 dark:text-white">
                        <div class="flex items-center">
                          <div
                            class="mr-2 inline-block h-4 w-4 rounded-full"
                            [ngClass]="product.stock > stockThreshold ? 'bg-green-400' : 'bg-red-700'"></div>
                          {{ product.stock }}
                        </div>
                      </td>
                      <td class="whitespace-nowrap px-4 py-2 font-medium text-gray-900 dark:text-white">
                        {{ product.price }}
                      </td>
                      <td class="whitespace-nowrap px-4 py-2 font-medium text-gray-900 dark:text-white">
                        {{ product.salePerDay }}
                      </td>
                      <td class="whitespace-nowrap px-4 py-2 font-medium text-gray-900 dark:text-white">
                        {{ product.salePerMonth }}
                      </td>
                      <td class="whitespace-nowrap px-4 py-2 font-medium text-gray-900 dark:text-white">
                        <sf-rating [rate]="product.rating" [readonly]="true">
                          <ng-template let-fill="fill" let-index="index">
                            <svg
                              aria-hidden="true"
                              class="h-5 w-5 text-gray-300"
                              fill="currentColor"
                              viewBox="0 0 20 20"
                              [ngClass]="{ 'text-yellow-400': fill === 100 }"
                              xmlns="http://www.w3.org/2000/svg">
                              <path
                                d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                            </svg>
                          </ng-template>
                        </sf-rating>
                      </td>
                      <td class="whitespace-nowrap px-4 py-2 font-medium text-gray-900 dark:text-white">
                        <div class="flex items-center">
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            viewbox="0 0 24 24"
                            fill="currentColor"
                            class="mr-2 h-5 w-5 text-gray-400"
                            aria-hidden="true">
                            <path
                              d="M2.25 2.25a.75.75 0 000 1.5h1.386c.17 0 .318.114.362.278l2.558 9.592a3.752 3.752 0 00-2.806 3.63c0 .414.336.75.75.75h15.75a.75.75 0 000-1.5H5.378A2.25 2.25 0 017.5 15h11.218a.75.75 0 00.674-.421 60.358 60.358 0 002.96-7.228.75.75 0 00-.525-.965A60.864 60.864 0 005.68 4.509l-.232-.867A1.875 1.875 0 003.636 2.25H2.25zM3.75 20.25a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zM16.5 20.25a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0z" />
                          </svg>
                          ${{ product.sales | shortNumber }}
                        </div>
                      </td>
                      <td class="px-4 py-2">${{ product.revenue | shortNumber }}</td>
                      <td class="whitespace-nowrap px-4 py-2 font-medium text-gray-900 dark:text-white">
                        {{ product.lastUpdate }}
                      </td>
                      <td class="whitespace-nowrap px-4 py-2 font-medium text-gray-900 dark:text-white">
                        <button mat-icon-button [matMenuTriggerFor]="listMenu">
                          <mat-icon>more_horiz</mat-icon>
                        </button>
                        <mat-menu #listMenu="matMenu">
                          <button
                            mat-menu-item
                            (click)="editProduct(product)"
                            routerLink="./edit/{{ product.id }}"
                            class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-600 dark:hover:text-white">
                            <div class="inline-flex items-center">
                              <mat-icon>edit_square</mat-icon>
                              Edit
                            </div>
                          </button>
                          <hr />
                          <button
                            mat-menu-item
                            (click)="deleteProduct(product)"
                            class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-600 dark:hover:text-white">
                            <div class="inline-flex items-center">
                              <mat-icon class="colo" style="color: red">delete</mat-icon>
                              Delete
                            </div>
                          </button>
                        </mat-menu>
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          </div>
          <mat-paginator
            class="z-10 border-b bg-gray-50 sm:fixed sm:inset-x-0 sm:bottom-0 sm:border-b-0 sm:border-t dark:bg-transparent"
            [ngClass]="{ 'pointer-events-none': isLoading }"
            [length]="pagination.total"
            [pageIndex]="pagination.page"
            [pageSize]="pagination.pageSize"
            [pageSizeOptions]="[10, 25, 100]"
            [showFirstLastButtons]="true">
          </mat-paginator>
        </div>
      </section>
    </mat-drawer-content>
  </mat-drawer-container>
</div>
